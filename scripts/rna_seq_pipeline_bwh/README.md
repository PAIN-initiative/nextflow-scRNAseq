# rnaseq-pipeline

Scripts for annotating 10x Genomics scRNA-seq analysis data

<a id="contents"></a>

## Contents

#### [Dependencies](#dependencies)

### 10x cellranger scRNA-seq data

#### [Metadata Annotation: tenx_rna_metadata_update.R](#meta)
- [Parameters](#meta_param)
- [Guidelines](#non)
  - [SampleSheet](#non_sample_sheet)
  - [Outputs](#non_out)



## Dependencies

This repository requires that `pandoc` and `libhdf5-dev` libraries are installed:
```
sudo apt-get install pandoc libhdf5-dev
```

It also depends on the `H5MANIPULATOR`, `jsonlite`, `rmarkdown`, and `optparse` libraries.

`jsonlite`, `rmarkdown` and `optparse` are available from CRAN, and can be installed in R using:
```
install.packages("jsonlite")
install.packages("rmarkdown")
install.packages("optparse")
```

`H5weaver` is found in the aifimmunology Github repositories. Install with:
```
Sys.setenv(GITHUB_PAT = "[your_PAT_here]")
devtools::install_github("acicalo2/H5MANIPULATOR")
```

[Return to Contents](#contents)

<a id="meta"></a>

## Metadata annotation for cellranger results

This repository can add important QC characteristics and cell metadata for 10x Genomics. It requires the `filtered_feature_bc_matrix.h5`, `molecule_info.h5`, and `metrics_summary.csv` files generated by `cellranger count` as inputs, as well as a `SampleSheet.csv` file (as described below), and generates a decorated output .h5 file and a JSON metrics file based on these parameters and a WellID.

[Return to Contents](#contents)

<a id="meta_param"></a>

There are 7 parameters for this script:  
- `-i or --in_h5`: The path to the filtered_feature_bc_matrix.h5 file from cellranger outs/  
- `-l or --in_mol`: The path to the molecule_info.h5 file from cellranger outs/  
- `-s or --in_sum`: The path to the metrics_summary.csv file from cellranger outs/  
- `-k or --in_key`: The path to SampleSheet.csv  
- `-j or --in_sample`: Sample Name 
- `-d or --out_dir`: A directory to use to output the modified .h5 and JSON metrics  
- `-o or --out_html`: A filename to use to output the HTML summary report file  

An example run for a cellranger count result is:
```
Rscript --vanilla \
  tenx-rnaseq-pipeline/tenx_rna_metadata_update.R \
  -i outs/filtered_feature_bc_matrix.h5 \
  -l outs/molecule_info.h5 \
  -s outs/metrics_summary.csv \
  -k outs/SampleSheet.csv \
  -j Sample_Name \
  -d output/Sample_Name \
  -o /output/Sample_Name/Sample_Name_metadata_report.html
```

[Return to Contents](#contents)

## `SampleSheet.csv` formats and output filenames


<a id="non"></a>

<a id="non_sample_sheet"></a>

####  `SampleSheet.csv`



It should have 3 columns: SampleID, Type (Control, Treatment), and LibraryID
```
SampleID,Type,LibraryID
CRCI1,Saline,CRN00234043
CRCI2,Saline,CRN00234044
CRCI3,Chemotherapy,CRN00234045
```

[Return to Contents](#contents)

<a id="non_out"></a>

#### output files

Outputs, two files will be generated. The .h5 will be named based on Library and SampleID, while the JSON metrics for this well will be named based on Library:  
- .h5 file: [SampleID]_[Type].h5, e.g. CRCI1.h5
- JSON file: [LibraryID]_sample_metrics.json, e.g. CRCI1-Saline_sample_metrics.json


[Return to Contents](#contents)
